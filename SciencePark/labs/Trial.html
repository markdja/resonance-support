<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clean Menu Foundation Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: #333;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #667eea;
        }
        
        .status-panel {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .status-good { border-left: 4px solid #28a745; }
        .status-warning { border-left: 4px solid #ffc107; }
        .status-error { border-left: 4px solid #dc3545; }
        
        .load-info {
            font-family: 'Courier New', monospace;
            background: #343a40;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.3s ease;
        }
        
        .test-button:hover {
            background: #5a6fd8;
        }
        
        .path-highlight {
            background: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üéõÔ∏è Clean Menu Foundation Test</h1>
            <p>Testing consciousness-menu.js in isolation</p>
            <p><strong>File Path:</strong> resonance-support/SciencePark/labs/Trial.html</p>
            <div class="path-highlight">
                <strong>CORRECT PATH:</strong> ../../common/consciousness-menu.js<br/>
                <small>(Two levels up: labs ‚Üí SciencePark ‚Üí resonance-support, then into common/)</small>
            </div>
        </div>

        <div id="loadStatus" class="status-panel status-warning">
            <h3>üì¶ Loading Status</h3>
            <p>Preparing to load consciousness-menu.js...</p>
        </div>

        <div class="status-panel">
            <h3>üîç What We're Testing</h3>
            <ul>
                <li>Clean load of <code>../../common/consciousness-menu.js</code></li>
                <li>ConsciousnessInterface class creation</li>
                <li>Menu system initialization</li>
                <li>Top menu bar appearance</li>
                <li>Settings dropdown functionality</li>
            </ul>
        </div>

        <div class="status-panel">
            <h3>üéØ Controls</h3>
            <button class="test-button" onclick="loadMenuSystem()">Load Menu System</button>
            <button class="test-button" onclick="testMenuFunctions()">Test Menu Functions</button>
            <button class="test-button" onclick="showMenuState()">Show Menu State</button>
            <button class="test-button" onclick="clearAll()">Clear All</button>
        </div>

        <div id="menuContainer">
            <!-- Menu system will appear here -->
        </div>

        <div class="status-panel">
            <h3>üìä Load Information</h3>
            <div id="loadInfo" class="load-info">
Ready to test consciousness-menu.js...<br/>
Click "Load Menu System" to begin.<br/>
            </div>
        </div>
    </div>

    <script>
        let loadLog = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            loadLog.push(logEntry);
            
            const logDiv = document.getElementById('loadInfo');
            logDiv.innerHTML += logEntry + '<br/>';
            logDiv.scrollTop = logDiv.scrollHeight;
            
            console.log(logEntry);
        }
        
        function updateStatus(message, type = 'warning') {
            const statusDiv = document.getElementById('loadStatus');
            statusDiv.className = `status-panel status-${type}`;
            statusDiv.innerHTML = `<h3>üì¶ Loading Status</h3><p>${message}</p>`;
        }
        
        function loadMenuSystem() {
            log('üöÄ Starting clean menu system load...');
            updateStatus('Loading consciousness-menu.js...', 'warning');
            
            // Clear any existing menu systems
            if (window.consciousnessInterface) {
                log('üóëÔ∏è Clearing existing consciousness interface');
                delete window.consciousnessInterface;
            }
            if (window.ConsciousnessInterface) {
                log('üóëÔ∏è Clearing existing ConsciousnessInterface class');
                delete window.ConsciousnessInterface;
            }
            
            // CORRECT PATH: Two levels up to get to resonance-support root
            const CORRECT_PATH = '../../common/consciousness-menu.js';
            log(`üìç Using path: ${CORRECT_PATH}`);
            
            const script = document.createElement('script');
            script.src = CORRECT_PATH;
            
            script.onload = function() {
                log('‚úÖ consciousness-menu.js loaded successfully!');
                log(`üîó Script loaded from: ${script.src}`);
                updateStatus('Script loaded! Checking for interface...', 'good');
                
                setTimeout(() => {
                    checkMenuSystem();
                }, 500);
            };
            
            script.onerror = function() {
                log('‚ùå Failed to load consciousness-menu.js');
                log(`üìç Attempted path: ${CORRECT_PATH}`);
                log(`üåê Full URL attempted: ${script.src}`);
                log('üîç Check if file exists at this exact path');
                updateStatus('Failed to load script! Check file path.', 'error');
            };
            
            document.head.appendChild(script);
            log('üì¶ Script tag added to document head');
        }
        
        function checkMenuSystem() {
            log('üîç Checking for consciousness interface...');
            
            // Check for the ConsciousnessInterface class
            if (window.ConsciousnessInterface) {
                log('‚úÖ ConsciousnessInterface class found!');
                
                try {
                    // Create an instance
                    window.consciousnessInterface = new window.ConsciousnessInterface();
                    log('‚úÖ ConsciousnessInterface instance created!');
                    
                    // Try to initialize
                    if (typeof window.consciousnessInterface.init === 'function') {
                        log('üéØ Calling consciousnessInterface.init()...');
                        window.consciousnessInterface.init();
                        log('‚úÖ Menu system initialized successfully');
                        updateStatus('Menu system active! ConsciousnessInterface loaded.', 'good');
                    } else {
                        log('‚ÑπÔ∏è No init method found, but class is loaded');
                        updateStatus('Class loaded but no init method found.', 'warning');
                    }
                } catch (error) {
                    log(`‚ùå Error creating instance: ${error.message}`);
                    updateStatus('Class found but initialization failed.', 'error');
                }
            } else if (window.consciousnessInterface) {
                log('‚úÖ consciousnessInterface object found!');
                log(`üìã Available methods: ${Object.keys(window.consciousnessInterface).join(', ')}`);
                updateStatus('Interface object loaded!', 'good');
            } else {
                log('‚ùå No consciousness interface found after script load');
                log('üîç Checking what was actually loaded...');
                
                // Check what consciousness-related objects exist
                const consciousnessObjects = Object.keys(window).filter(key => 
                    key.toLowerCase().includes('consciousness') || 
                    key.toLowerCase().includes('menu') ||
                    key.toLowerCase().includes('interface')
                );
                
                if (consciousnessObjects.length > 0) {
                    log(`üìã Found objects: ${consciousnessObjects.join(', ')}`);
                } else {
                    log('‚ùå No consciousness-related objects found');
                }
                
                updateStatus('Script loaded but no interface created.', 'error');
            }
        }
        
        function testMenuFunctions() {
            log('üß™ Testing menu functions...');
            
            if (!window.consciousnessInterface && !window.ConsciousnessInterface) {
                log('‚ùå No consciousness interface to test');
                return;
            }
            
            const testTarget = window.consciousnessInterface || window.ConsciousnessInterface.prototype;
            const methods = Object.getOwnPropertyNames(testTarget);
            log(`üîç Testing ${methods.length} methods/properties...`);
            
            methods.forEach(method => {
                if (typeof testTarget[method] === 'function') {
                    log(`‚úÖ ${method}: function`);
                } else {
                    log(`üìÑ ${method}: ${typeof testTarget[method]}`);
                }
            });
            
            // Try to toggle interface if method exists
            if (window.consciousnessInterface && typeof window.consciousnessInterface.toggleInterface === 'function') {
                log('üéØ Testing toggleInterface...');
                try {
                    window.consciousnessInterface.toggleInterface();
                    log('‚úÖ toggleInterface executed successfully');
                } catch (error) {
                    log(`‚ùå toggleInterface error: ${error.message}`);
                }
            }
        }
        
        function showMenuState() {
            log('üìä Current menu system state:');
            log(`- ConsciousnessInterface class: ${!!window.ConsciousnessInterface}`);
            log(`- consciousnessInterface instance: ${!!window.consciousnessInterface}`);
            
            if (window.consciousnessInterface) {
                log(`- isMenuVisible: ${window.consciousnessInterface.isMenuVisible || 'undefined'}`);
                log(`- Instance keys: ${Object.keys(window.consciousnessInterface).join(', ')}`);
            }
            
            // Check for menu elements in DOM
            const menuElements = document.querySelectorAll('[id*="menu"], [class*="menu"], [id*="consciousness"]');
            log(`- DOM menu elements found: ${menuElements.length}`);
            
            menuElements.forEach((el, index) => {
                log(`  ${index + 1}. ${el.tagName}#${el.id || 'no-id'}.${el.className || 'no-class'}`);
            });
        }
        
        function clearAll() {
            log('üóëÔ∏è Clearing all systems...');
            
            // Remove consciousness interface
            if (window.consciousnessInterface) {
                delete window.consciousnessInterface;
                log('‚úÖ consciousnessInterface instance cleared');
            }
            
            if (window.ConsciousnessInterface) {
                delete window.ConsciousnessInterface;
                log('‚úÖ ConsciousnessInterface class cleared');
            }
            
            // Remove any menu elements
            const menuElements = document.querySelectorAll('[id*="menu"], [class*="menu"], [id*="consciousness"]');
            menuElements.forEach(el => {
                el.remove();
                log(`üóëÔ∏è Removed element: ${el.tagName}#${el.id}`);
            });
            
            // Remove scripts
            const scripts = document.querySelectorAll('script[src*="consciousness"]');
            scripts.forEach(script => {
                script.remove();
                log(`üóëÔ∏è Removed script: ${script.src}`);
            });
            
            updateStatus('All systems cleared. Ready for fresh test.', 'warning');
            log('‚úÖ Clear complete');
        }
        
        // Initial status
        log('üî¨ Clean Menu Foundation Test initialized');
        log('üìÅ Testing from: resonance-support/SciencePark/labs/Trial.html');
        log('üéØ Target: ../../common/consciousness-menu.js (CORRECT PATH)');
        log('üìç This should resolve to: resonance-support/common/consciousness-menu.js');
    </script>
</body>
</html>
